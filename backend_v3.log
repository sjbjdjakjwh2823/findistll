INFO:     Started server process [36312]
INFO:     Waiting for application startup.
INFO:     Starting database auto-migration...
INFO:     Vector extension checked/created.
INFO:     Database tables checked/created successfully.
INFO:     Column 'file_type' checked/added to documents table.
INFO:     FK constraint 'documents_user_id_fkey' dropped (if existed).
INFO:     Column 'user_id' is already VARCHAR type.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
WARNING:api.services.ingestion:Gemini API Key missing. Returning mock response.
INFO:httpx:HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:embedContent?key= "HTTP/1.1 403 Forbidden"
ERROR:    Error processing request: Client error '403 Forbidden' for url 'https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:embedContent?key='
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403
Traceback (most recent call last):
  File "C:\Users\Administrator\project_1\api\app.py", line 244, in extract_document
    embedding = await embedder.generate_embedding(embed_text)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Administrator\project_1\api\services\embedder.py", line 46, in generate_embedding
    return await self._call_embed_api(text, "RETRIEVAL_DOCUMENT")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Administrator\project_1\api\services\embedder.py", line 72, in _call_embed_api
    response.raise_for_status()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '403 Forbidden' for url 'https://generativelanguage.googleapis.com/v1beta/models/text-embedding-004:embedContent?key='
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403
[AUTH DEBUG] Loaded NEXT_PUBLIC_SB_URL using key: SUPABASE_URL
[AUTH DEBUG] Loaded SUPABASE_ANON_KEY using key: SUPABASE_ANON_KEY
[AUTH DEBUG] Loaded SUPABASE_JWT_SECRET using key: SUPABASE_JWT_SECRET
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:57980 - "POST /api/extract HTTP/1.1" 500 Internal Server Error
