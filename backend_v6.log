INFO:     Started server process [34188]
INFO:     Waiting for application startup.
INFO:     Starting database auto-migration...
INFO:     Vector extension checked/created.
INFO:     Database tables checked/created successfully.
INFO:     Column 'file_type' checked/added to documents table.
INFO:     FK constraint 'documents_user_id_fkey' dropped (if existed).
INFO:     Column 'user_id' is already VARCHAR type.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
WARNING:api.services.ingestion:Gemini API Key missing. Returning mock response.
[AUTH DEBUG] Loaded NEXT_PUBLIC_SB_URL using key: SUPABASE_URL
[AUTH DEBUG] Loaded SUPABASE_ANON_KEY using key: SUPABASE_ANON_KEY
[AUTH DEBUG] Loaded SUPABASE_JWT_SECRET using key: SUPABASE_JWT_SECRET
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:58195 - "POST /api/extract HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/jsonl/9
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
V11.5 EXPORT READY: 5 Rows Found
INFO:     127.0.0.1:58199 - "GET /api/export/jsonl/9 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/markdown/9
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58202 - "GET /api/export/markdown/9 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/parquet/9
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58205 - "GET /api/export/parquet/9 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/hdf5/9
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58208 - "GET /api/export/hdf5/9 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
WARNING:api.services.ingestion:Gemini API Key missing. Returning mock response.
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:58211 - "POST /api/extract HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/jsonl/10
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
V11.5 EXPORT READY: 9 Rows Found
INFO:     127.0.0.1:58217 - "GET /api/export/jsonl/10 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/markdown/10
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58220 - "GET /api/export/markdown/10 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/parquet/10
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58223 - "GET /api/export/parquet/10 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/hdf5/10
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58226 - "GET /api/export/hdf5/10 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
WARNING:api.services.ingestion:Gemini API Key missing. Returning mock response.
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:58229 - "POST /api/extract HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/jsonl/11
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
V11.5 EXPORT READY: 2 Rows Found
INFO:     127.0.0.1:58233 - "GET /api/export/jsonl/11 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/markdown/11
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58236 - "GET /api/export/markdown/11 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/parquet/11
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58239 - "GET /api/export/parquet/11 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/hdf5/11
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58250 - "GET /api/export/hdf5/11 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
ERROR:api.services.xbrl_semantic_engine:Processing failed: unbound prefix: line 11, column 8
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:58253 - "POST /api/extract HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/jsonl/12
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
ERROR:api.services.exporter:CRITICAL: reasoning_qa is empty. Aborting export.
CRITICAL: [API CRITICAL] Unhandled exception in request: CRITICAL ERROR: Reasoning QA list is empty. Engine failed to generate data.
Traceback (most recent call last):
  File "C:\Users\Administrator\project_1\api\app.py", line 129, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Administrator\project_1\api\app.py", line 362, in export_jsonl
    jsonl_content = exporter.to_jsonl(data)
                    ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Administrator\project_1\api\services\exporter.py", line 39, in to_jsonl
    raise ValueError("CRITICAL ERROR: Reasoning QA list is empty. Engine failed to generate data.")
ValueError: CRITICAL ERROR: Reasoning QA list is empty. Engine failed to generate data.
INFO:     127.0.0.1:58257 - "GET /api/export/jsonl/12 HTTP/1.1" 500 Internal Server Error
INFO:     [API DEBUG] Request: GET /api/export/markdown/12
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58260 - "GET /api/export/markdown/12 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/parquet/12
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58263 - "GET /api/export/parquet/12 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/hdf5/12
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58266 - "GET /api/export/hdf5/12 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
WARNING:api.services.ingestion:Gemini API Key missing. Returning mock response.
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:58269 - "POST /api/extract HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/jsonl/13
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
V11.5 EXPORT READY: 1 Rows Found
INFO:     127.0.0.1:58273 - "GET /api/export/jsonl/13 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/markdown/13
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58276 - "GET /api/export/markdown/13 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/parquet/13
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58279 - "GET /api/export/parquet/13 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/hdf5/13
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58283 - "GET /api/export/hdf5/13 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
WARNING:api.services.ingestion:Gemini API Key missing. Returning mock response.
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:58290 - "POST /api/extract HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/jsonl/14
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
V11.5 EXPORT READY: 5 Rows Found
INFO:     127.0.0.1:58294 - "GET /api/export/jsonl/14 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/markdown/14
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58297 - "GET /api/export/markdown/14 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/parquet/14
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58300 - "GET /api/export/parquet/14 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/hdf5/14
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58303 - "GET /api/export/hdf5/14 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
WARNING:api.services.ingestion:Gemini API Key missing. Returning mock response.
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:58306 - "POST /api/extract HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/jsonl/15
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
V11.5 EXPORT READY: 9 Rows Found
INFO:     127.0.0.1:58310 - "GET /api/export/jsonl/15 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/markdown/15
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58313 - "GET /api/export/markdown/15 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/parquet/15
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58316 - "GET /api/export/parquet/15 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/hdf5/15
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58319 - "GET /api/export/hdf5/15 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
WARNING:api.services.ingestion:Gemini API Key missing. Returning mock response.
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:58322 - "POST /api/extract HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/jsonl/16
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
V11.5 EXPORT READY: 2 Rows Found
INFO:     127.0.0.1:58326 - "GET /api/export/jsonl/16 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/markdown/16
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58329 - "GET /api/export/markdown/16 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/parquet/16
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58332 - "GET /api/export/parquet/16 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/hdf5/16
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58344 - "GET /api/export/hdf5/16 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
WARNING:api.services.xbrl_semantic_engine:V13.2 TIME SERIES AI: Selected CY=2024-12-31, PY=2023-12-31
WARNING:api.services.xbrl_semantic_engine:TRACE 1: Found 3 facts in XML (V13.2 Greedy Parsing)
WARNING:api.services.xbrl_semantic_engine:ENV CHECK: LLM_API_KEY_PRESENT = False
WARNING:api.services.xbrl_semantic_engine:TRACE: Total facts found in XML = 3
WARNING:api.services.xbrl_semantic_engine:V13.2 COMPLETE: BUILD SUCCESS & YoY ACTIVE 3 CHAINS FROM 3 FACTS
INFO:api.services.xbrl_semantic_engine:V13.2 COMPLETE: BUILD SUCCESS & YoY ACTIVE 3 FACTS
WARNING:api.services.xbrl_semantic_engine:V13.2 PIPELINE INTEGRITY: JSONL GENERATION ACTIVE
INFO:api.services.ingestion:V11.5 DATA RECOVERED: [3] ROWS READY
INFO:api.services.ingestion:TRACE 5: Final data count being sent to Exporter: 3
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:58347 - "POST /api/extract HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/jsonl/17
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58351 - "GET /api/export/jsonl/17 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/markdown/17
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58354 - "GET /api/export/markdown/17 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/parquet/17
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58357 - "GET /api/export/parquet/17 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/hdf5/17
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58362 - "GET /api/export/hdf5/17 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: POST /api/extract
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     Processing extraction for user None via HUB
WARNING:api.services.ingestion:Gemini API Key missing. Returning mock response.
[AUTH DEBUG] Token Header: {'alg': 'HS256', 'typ': 'JWT'}
[AUTH DEBUG] Token verified successfully for user: test-user-123
INFO:     127.0.0.1:58365 - "POST /api/extract HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/jsonl/18
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
V11.5 EXPORT READY: 1 Rows Found
INFO:     127.0.0.1:58369 - "GET /api/export/jsonl/18 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/markdown/18
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58372 - "GET /api/export/markdown/18 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/parquet/18
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58375 - "GET /api/export/parquet/18 HTTP/1.1" 200 OK
INFO:     [API DEBUG] Request: GET /api/export/hdf5/18
INFO:     [API DEBUG] Auth Header present: Bearer eyJ...
INFO:     127.0.0.1:58378 - "GET /api/export/hdf5/18 HTTP/1.1" 200 OK
